# Release Process

This document describes how to create a new release of AXON.

## Overview

AXON uses GitHub Actions to automatically create releases when version tags are pushed. The process is streamlined with helper scripts.

**Prerequisites**: GitHub App configured for automated releases. See [github-app-setup.md](github-app-setup.md) for setup instructions.

## Quick Release (Recommended)

Use the automated release script:

```bash
./release/create-release.sh
```

This will:
1. Prompt for the new version number
2. Update the VERSION file
3. Create a git commit
4. Create a git tag
5. Optionally push to GitHub
6. Trigger **fully automated** release creation

**That's it!** GitHub Actions will automatically:
- Create the release with changelog
- Calculate SHA256 for the tarball
- Update homebrew/axon.rb with the correct SHA256
- Commit and push the Homebrew formula update

No manual steps required!

## Manual Release Process

If you prefer to do it manually:

### Step 1: Update Version

```bash
# Update VERSION file
echo "0.2.0" > VERSION

# Commit the change
git add VERSION
git commit -m "Release v0.2.0"
```

### Step 2: Create and Push Tag

```bash
# Create annotated tag
git tag -a v0.2.0 -m "Release v0.2.0"

# Push commit and tag
git push origin main
git push origin v0.2.0
```

### Step 3: GitHub Actions Does Everything Automatically

Once you push the tag, GitHub Actions will:
- Generate a changelog from commits since the last tag
- Create a GitHub release
- Attach installation files (install.sh, uninstall.sh, axon.rb)
- Generate release notes
- **Download the release tarball**
- **Calculate SHA256 hash**
- **Update homebrew/axon.rb automatically**
- **Commit and push the Homebrew formula update**

View progress at: https://github.com/ezoushen/axon/actions

**That's it! Everything is done automatically.** No manual SHA256 updates needed.

## Version Numbering

AXON follows [Semantic Versioning](https://semver.org/)

## Pre-release Checklist

Before creating a release:

- [ ] All tests pass locally
- [ ] All documentation is up to date
- [ ] README.md reflects current features
- [ ] No uncommitted changes (or intentionally committed)
- [ ] CHANGELOG or commit messages are clear
- [ ] Version number follows semantic versioning

## GitHub Actions Workflow

The release workflow (`.github/workflows/release.yml`) triggers on tags matching `v*.*.*` and:

1. **Checkout code**: Fetches full git history for changelog
2. **Generate changelog**: Creates changelog from commits since last tag
3. **Create release**: Publishes GitHub release with:
   - Generated changelog
   - Auto-generated release notes from GitHub
   - Attached files: VERSION, install.sh, uninstall.sh, axon.rb
4. **Wait for assets**: Gives GitHub time to generate release tarball (~10 seconds)
5. **Update Homebrew formula**:
   - Downloads release tarball
   - Calculates SHA256 hash
   - Updates homebrew/axon.rb with correct SHA256, version, and URL
6. **Commit and push**: Automatically commits and pushes the Homebrew formula update
7. **Display summary**: Shows release URL, tarball URL, and SHA256

## Release Assets

Each release includes:

- **Source code** (zip/tar.gz): Automatically generated by GitHub
- **VERSION**: Version number file
- **install.sh**: Installation script
- **uninstall.sh**: Uninstallation script
- **axon.rb**: Homebrew formula

## Installation After Release

Once released, users can install via:

### Quick Install
```bash
curl -fsSL https://raw.githubusercontent.com/ezoushen/axon/main/install.sh | bash
```

### Homebrew (after tap is created)
```bash
brew tap ezoushen/axon
brew install axon
```

### Manual
```bash
git clone https://github.com/ezoushen/axon.git ~/.axon
sudo ln -s ~/.axon/axon /usr/local/bin/axon
```

## Troubleshooting

### GitHub Actions fails to create release

**Check permissions:**
- Ensure the workflow has `contents: write` permission (already configured)
- Check Actions tab for error details

### Tarball URL returns 404

**Wait for release:**
- GitHub takes 1-2 minutes to generate release assets
- Verify release exists at: https://github.com/ezoushen/axon/releases

### SHA256 calculation fails

**Verify release exists:**
```bash
# Check if release is created
curl -I https://github.com/ezoushen/axon/archive/refs/tags/v0.2.0.tar.gz

# Should return 200 OK, not 404
```

### Tag already exists

**Delete and recreate:**
```bash
# Delete local tag
git tag -d v0.2.0

# Delete remote tag
git push origin :refs/tags/v0.2.0

# Recreate tag
git tag -a v0.2.0 -m "Release v0.2.0"
git push origin v0.2.0
```

## Example Release

```bash
# 1. Create and push release
./release/create-release.sh
# Enter version: 0.2.0
# Confirm push: y

# 2. Wait for GitHub Actions to complete (~1-2 minutes)
# View at: https://github.com/ezoushen/axon/actions

# Done! ðŸŽ‰
# Everything else is automated:
# - Release created
# - Homebrew formula updated
# - SHA256 calculated and committed
```

## Post-Release

After releasing:

1. **Announce**: Update any documentation or announcement channels
2. **Test install**: Verify installation methods work
3. **Monitor**: Watch for issues from users
4. **Plan next**: Add items for next release to project tracker

## Helper Scripts

- **release/create-release.sh**: Automate version tagging and release (primary tool)
- **release/update-homebrew-sha.sh**: Manual Homebrew formula SHA256 update (rarely needed - GitHub Actions does this automatically)

The create-release.sh script is all you need for normal releases. The update-homebrew-sha.sh script is only useful if you need to manually update the Homebrew formula outside of the normal release process.
